<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Snowflake_Snow_32px_32px.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Snowflake_Snow_16px_16px.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="Pureven" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: true,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"default"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="引言加载类在控制器基类中引入并完成初始化，主要负责对package、library、view、driver、helper、model、config等文件的加载。在配置文件中可以设置自动加载，当然也可以在具体业务实现过程中手动加载需要的文件。">
<meta name="keywords" content="PHP,Codeigniter">
<meta property="og:type" content="article">
<meta property="og:title" content="CodeIgniter加载类文件Loader.php">
<meta property="og:url" content="https:&#x2F;&#x2F;pureven.cc&#x2F;2020&#x2F;02&#x2F;17&#x2F;codeigniter-loader&#x2F;index.html">
<meta property="og:site_name" content="Pureven">
<meta property="og:description" content="引言加载类在控制器基类中引入并完成初始化，主要负责对package、library、view、driver、helper、model、config等文件的加载。在配置文件中可以设置自动加载，当然也可以在具体业务实现过程中手动加载需要的文件。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-13T00:41:43.121Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://pureven.cc/2020/02/17/codeigniter-loader/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>CodeIgniter加载类文件Loader.php | Pureven</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Pureven</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">行者无疆</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">13</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">41</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pureven.cc/2020/02/17/codeigniter-loader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Snowflake_Snow.png">
      <meta itemprop="name" content="W E N C H A O">
      <meta itemprop="description" content="不积跬步•无以至千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pureven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          CodeIgniter加载类文件Loader.php
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-17 08:43:36" itemprop="dateCreated datePublished" datetime="2020-02-17T08:43:36+08:00">2020-02-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-13 08:41:43" itemprop="dateModified" datetime="2020-04-13T08:41:43+08:00">2020-04-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BC%80%E5%8F%91%E8%80%85%E6%89%8B%E5%86%8C/" itemprop="url" rel="index">
                    <span itemprop="name">开发者手册</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/02/17/codeigniter-loader/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/02/17/codeigniter-loader/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>25 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p>加载类在控制器基类中引入并完成初始化，主要负责对package、library、view、driver、helper、model、config等文件的加载。在配置文件中可以设置自动加载，当然也可以在具体业务实现过程中手动加载需要的文件。</p>
<a id="more"></a>

<hr>
<h4 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $_ci_ob_level; <span class="comment">// 缓冲机制的嵌套级别</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_view_paths =	<span class="keyword">array</span>(VIEWPATH	=&gt; <span class="keyword">TRUE</span>); <span class="comment">// 待加载视图文件路径</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_library_paths =	<span class="keyword">array</span>(APPPATH, BASEPATH); <span class="comment">// 待加载类库文件路径</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_model_paths =	<span class="keyword">array</span>(APPPATH);  <span class="comment">// 待加载模型文件路径</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_helper_paths =	<span class="keyword">array</span>(APPPATH, BASEPATH); <span class="comment">// 待加载帮助文件路径</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_cached_vars =	<span class="keyword">array</span>(); <span class="comment">// 待加载缓存文件路径</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_classes =	<span class="keyword">array</span>(); <span class="comment">// 用于保存已加载的类</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_models =	<span class="keyword">array</span>(); <span class="comment">// 用于保存已加载的模型</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_helpers =	<span class="keyword">array</span>(); <span class="comment">// 用于保存已加载的帮助文件</span></span><br><span class="line"><span class="keyword">protected</span> $_ci_varmap =	<span class="keyword">array</span>( <span class="comment">// 类的别名映射，名字太长的映射个短点儿的</span></span><br><span class="line">    <span class="string">'unit_test'</span> =&gt; <span class="string">'unit'</span>,</span><br><span class="line">    <span class="string">'user_agent'</span> =&gt; <span class="string">'agent'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ob_get_level(): 输出缓冲机制的嵌套级别</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_ob_level = ob_get_level();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is_loaded(): 返回已加载的类，此处完成交接，此处_ci_classes也用来保管</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_classes =&amp; is_loaded();</span><br><span class="line"></span><br><span class="line">    log_message(<span class="string">'info'</span>, <span class="string">'Loader Class Initialized'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="initialize"><a href="#initialize" class="headerlink" title="initialize()"></a>initialize()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_autoloader();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方法在控制器基类中调用，用于初始化加载类，根据配置的自动加载文件进行完成自动加载。</p>
<hr>
<h4 id="is-loaded"><a href="#is-loaded" class="headerlink" title="is_loaded()"></a>is_loaded()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">is_loaded</span><span class="params">($class)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 若加载了返回类名或者指定的名称，未加载则返回false</span></span><br><span class="line">    <span class="keyword">return</span> array_search(ucfirst($class), <span class="keyword">$this</span>-&gt;_ci_classes, <span class="keyword">TRUE</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="library"><a href="#library" class="headerlink" title="library()"></a>library()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">library</span><span class="params">($library, $params = NULL, $object_name = NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($library))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (is_array($library))</span><br><span class="line">    &#123; <span class="comment">// 支持数组形式同时加载多个类库：$this-&gt;load-&gt;library(['test', 'database']);</span></span><br><span class="line">        <span class="keyword">foreach</span> ($library <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_int($key))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;library($value, $params);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;library($key, $params, $value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($params !== <span class="keyword">NULL</span> &amp;&amp; ! is_array($params))</span><br><span class="line">    &#123;</span><br><span class="line">        $params = <span class="keyword">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_load_library($library, $params, $object_name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当执行<code>$this-&gt;load-&gt;library(&#39;xxx&#39;);</code>时走的这个方法。</p>
<hr>
<h4 id="model"><a href="#model" class="headerlink" title="model()"></a>model()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">model</span><span class="params">($model, $name = <span class="string">''</span>, $db_conn = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($model))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (is_array($model))</span><br><span class="line">    &#123; <span class="comment">// 可以同时加载多个model</span></span><br><span class="line">        <span class="keyword">foreach</span> ($model <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">        &#123;</span><br><span class="line">            is_int($key) ? <span class="keyword">$this</span>-&gt;model($value, <span class="string">''</span>, $db_conn) : <span class="keyword">$this</span>-&gt;model($key, $value, $db_conn);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $path = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果加载的model字符串中有子目录</span></span><br><span class="line">    <span class="comment">// 如:$this-&gt;load-&gt;model('user/base_model')表示加载的是user目录下的Base_model.php</span></span><br><span class="line">    <span class="keyword">if</span> (($last_slash = strrpos($model, <span class="string">'/'</span>)) !== <span class="keyword">FALSE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// $last_slash为'/'最后一次出现的位置，$path即去掉文件名剩下的路径信息</span></span><br><span class="line">        $path = substr($model, <span class="number">0</span>, ++$last_slash);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $model为文件名</span></span><br><span class="line">        $model = substr($model, $last_slash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 有时候model文件名会很长，因此会映射一个简短的名称，也就是这里的$name</span></span><br><span class="line">    <span class="comment">// 比如： $this-&gt;load-&gt;model('hello_world_I_am_comming_model', 'hello_model');</span></span><br><span class="line">    <span class="comment">// 然后执行$this-&gt;hello_model-&gt;xxx()去调用其中的方法就ok了。</span></span><br><span class="line">    <span class="comment">// 如果不指定则使用$model，即'hello_world_I_am_comming_model'。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($name))</span><br><span class="line">    &#123;</span><br><span class="line">        $name = $model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (in_array($name, <span class="keyword">$this</span>-&gt;_ci_models, <span class="keyword">TRUE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重复加载会抛出异常</span></span><br><span class="line">    $CI =&amp; get_instance();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($CI-&gt;$name))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'The model name you are loading is the name of a resource that is already being used: '</span>.$name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果要求同时连接数据库则调用$this-&gt;database()加载数据库</span></span><br><span class="line">    <span class="keyword">if</span> ($db_conn !== <span class="keyword">FALSE</span> &amp;&amp; ! class_exists(<span class="string">'CI_DB'</span>, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($db_conn === <span class="keyword">TRUE</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $db_conn = <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;database($db_conn, <span class="keyword">FALSE</span>, <span class="keyword">TRUE</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! class_exists(<span class="string">'CI_Model'</span>, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// application目录下如果存在Model.php则加载此文件，这个文件代替system目录下的同名文件作为基类，因此类名为CI_Model</span></span><br><span class="line">        $app_path = APPPATH.<span class="string">'core'</span>.DIRECTORY_SEPARATOR;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($app_path.<span class="string">'Model.php'</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">require_once</span>($app_path.<span class="string">'Model.php'</span>);</span><br><span class="line">            <span class="comment">// 如果加载后发现该文件类名不为CI_Model.php则报错</span></span><br><span class="line">            <span class="keyword">if</span> ( ! class_exists(<span class="string">'CI_Model'</span>, <span class="keyword">FALSE</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException($app_path.<span class="string">"Model.php exists, but doesn't declare class CI_Model"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log_message(<span class="string">'info'</span>, <span class="string">'CI_Model class loaded'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> ( ! class_exists(<span class="string">'CI_Model'</span>, <span class="keyword">FALSE</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">require_once</span>(BASEPATH.<span class="string">'core'</span>.DIRECTORY_SEPARATOR.<span class="string">'Model.php'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 加载子类</span></span><br><span class="line">        $class = config_item(<span class="string">'subclass_prefix'</span>).<span class="string">'Model'</span>;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($app_path.$class.<span class="string">'.php'</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">require_once</span>($app_path.$class.<span class="string">'.php'</span>);</span><br><span class="line">            <span class="comment">// 子类名与文件名不一致则抛出异常</span></span><br><span class="line">            <span class="keyword">if</span> ( ! class_exists($class, <span class="keyword">FALSE</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException($app_path.$class.<span class="string">".php exists, but doesn't declare class "</span>.$class);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log_message(<span class="string">'info'</span>, config_item(<span class="string">'subclass_prefix'</span>).<span class="string">'Model class loaded'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $model = ucfirst($model);</span><br><span class="line">    <span class="keyword">if</span> ( ! class_exists($model, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_ci_model_paths <span class="keyword">as</span> $mod_path)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ( ! file_exists($mod_path.<span class="string">'models/'</span>.$path.$model.<span class="string">'.php'</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 注意这里是'models/'.$path.$model.'.php'，子目录用在这。</span></span><br><span class="line">            <span class="keyword">require_once</span>($mod_path.<span class="string">'models/'</span>.$path.$model.<span class="string">'.php'</span>);</span><br><span class="line">            <span class="comment">// 加载了但是类名不存在则抛出异常</span></span><br><span class="line">            <span class="keyword">if</span> ( ! class_exists($model, <span class="keyword">FALSE</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException($mod_path.<span class="string">"models/"</span>.$path.$model.<span class="string">".php exists, but doesn't declare class "</span>.$model);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 加了一遍发现类名不存在则抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> ( ! class_exists($model, <span class="keyword">FALSE</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'Unable to locate the model you have specified: '</span>.$model);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ( ! is_subclass_of($model, <span class="string">'CI_Model'</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果该类存在但是不是CI_Model的子类则抛出异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Class "</span>.$model.<span class="string">" already exists and doesn't extend CI_Model"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加载完了将$name，也就是映射后的名称放入'_ci_models'</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_models[] = $name;</span><br><span class="line">    $model = <span class="keyword">new</span> $model();</span><br><span class="line">    $CI-&gt;$name = $model; <span class="comment">// 这里完成映射</span></span><br><span class="line">    log_message(<span class="string">'info'</span>, <span class="string">'Model "'</span>.get_class($model).<span class="string">'" initialized'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="database"><a href="#database" class="headerlink" title="database()"></a>database()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">database</span><span class="params">($params = <span class="string">''</span>, $return = FALSE, $query_builder = NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Grab the super object</span></span><br><span class="line">    $CI =&amp; get_instance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 已经加载了就不重复加载了</span></span><br><span class="line">    <span class="keyword">if</span> ($return === <span class="keyword">FALSE</span> &amp;&amp; $query_builder === <span class="keyword">NULL</span> &amp;&amp; <span class="keyword">isset</span>($CI-&gt;db) &amp;&amp; is_object($CI-&gt;db) &amp;&amp; ! <span class="keyword">empty</span>($CI-&gt;db-&gt;conn_id))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">require_once</span>(BASEPATH.<span class="string">'database/DB.php'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($return === <span class="keyword">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 这里DB是个方法</span></span><br><span class="line">        <span class="keyword">return</span> DB($params, $query_builder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the db variable. Needed to prevent</span></span><br><span class="line">    <span class="comment">// reference errors with some configurations</span></span><br><span class="line">    $CI-&gt;db = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load the DB class</span></span><br><span class="line">    $CI-&gt;db =&amp; DB($params, $query_builder);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="dbutil"><a href="#dbutil" class="headerlink" title="dbutil()"></a>dbutil()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dbutil</span><span class="params">($db = NULL, $return = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $CI =&amp; get_instance();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! is_object($db) <span class="keyword">OR</span> ! ($db <span class="keyword">instanceof</span> CI_DB))</span><br><span class="line">    &#123;</span><br><span class="line">        class_exists(<span class="string">'CI_DB'</span>, <span class="keyword">FALSE</span>) <span class="keyword">OR</span> <span class="keyword">$this</span>-&gt;database();<span class="comment">// 没有参数，这里加载的是数据库工具类</span></span><br><span class="line">        $db =&amp; $CI-&gt;db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">require_once</span>(BASEPATH.<span class="string">'database/DB_utility.php'</span>);<span class="comment">// dbdriver为mssql mysql postgre pdo ...</span></span><br><span class="line">    <span class="keyword">require_once</span>(BASEPATH.<span class="string">'database/drivers/'</span>.$db-&gt;dbdriver.<span class="string">'/'</span>.$db-&gt;dbdriver.<span class="string">'_utility.php'</span>);</span><br><span class="line">    $class = <span class="string">'CI_DB_'</span>.$db-&gt;dbdriver.<span class="string">'_utility'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($return === <span class="keyword">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> $class($db);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $CI-&gt;dbutil = <span class="keyword">new</span> $class($db);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="dbforge"><a href="#dbforge" class="headerlink" title="dbforge()"></a>dbforge()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dbforge</span><span class="params">($db = NULL, $return = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $CI =&amp; get_instance();</span><br><span class="line">    <span class="keyword">if</span> ( ! is_object($db) <span class="keyword">OR</span> ! ($db <span class="keyword">instanceof</span> CI_DB))</span><br><span class="line">    &#123;</span><br><span class="line">        class_exists(<span class="string">'CI_DB'</span>, <span class="keyword">FALSE</span>) <span class="keyword">OR</span> <span class="keyword">$this</span>-&gt;database();</span><br><span class="line">        $db =&amp; $CI-&gt;db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">require_once</span>(BASEPATH.<span class="string">'database/DB_forge.php'</span>);</span><br><span class="line">    <span class="keyword">require_once</span>(BASEPATH.<span class="string">'database/drivers/'</span>.$db-&gt;dbdriver.<span class="string">'/'</span>.$db-&gt;dbdriver.<span class="string">'_forge.php'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! <span class="keyword">empty</span>($db-&gt;subdriver))</span><br><span class="line">    &#123;</span><br><span class="line">        $driver_path = BASEPATH.<span class="string">'database/drivers/'</span>.$db-&gt;dbdriver.<span class="string">'/subdrivers/'</span>.$db-&gt;dbdriver.<span class="string">'_'</span>.$db-&gt;subdriver.<span class="string">'_forge.php'</span>;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($driver_path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">require_once</span>($driver_path);</span><br><span class="line">            $class = <span class="string">'CI_DB_'</span>.$db-&gt;dbdriver.<span class="string">'_'</span>.$db-&gt;subdriver.<span class="string">'_forge'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $class = <span class="string">'CI_DB_'</span>.$db-&gt;dbdriver.<span class="string">'_forge'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($return === <span class="keyword">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> $class($db);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $CI-&gt;dbforge = <span class="keyword">new</span> $class($db);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加载数据库锻造类。</p>
<hr>
<h4 id="view"><a href="#view" class="headerlink" title="view()"></a>view()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view</span><span class="params">($view, $vars = array<span class="params">()</span>, $return = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_load(<span class="keyword">array</span>(<span class="string">'_ci_view'</span> =&gt; $view, <span class="string">'_ci_vars'</span> =&gt; <span class="keyword">$this</span>-&gt;_ci_prepare_view_vars($vars), <span class="string">'_ci_return'</span> =&gt; $return));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加载视图。</p>
<hr>
<h4 id="file"><a href="#file" class="headerlink" title="file()"></a>file()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file</span><span class="params">($path, $return = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_load(<span class="keyword">array</span>(<span class="string">'_ci_path'</span> =&gt; $path, <span class="string">'_ci_return'</span> =&gt; $return));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加载文件。</p>
<hr>
<h4 id="vars"><a href="#vars" class="headerlink" title="vars()"></a>vars()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vars</span><span class="params">($vars, $val = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 确保参数为数组格式</span></span><br><span class="line">    $vars = is_string($vars)</span><br><span class="line">        ? <span class="keyword">array</span>($vars =&gt; $val)</span><br><span class="line">        : <span class="keyword">$this</span>-&gt;_ci_prepare_view_vars($vars);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($vars <span class="keyword">as</span> $key =&gt; $val)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_ci_cached_vars[$key] = $val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置变量。</p>
<hr>
<h4 id="clear-vars"><a href="#clear-vars" class="headerlink" title="clear_vars()"></a>clear_vars()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clear_vars</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_cached_vars = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>清空缓存的变量。</p>
<hr>
<h4 id="get-var"><a href="#get-var" class="headerlink" title="get_var()"></a>get_var()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_var</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_cached_vars[$key]) ? <span class="keyword">$this</span>-&gt;_ci_cached_vars[$key] : <span class="keyword">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>检查并获取某个变量。</p>
<hr>
<h4 id="get-vars"><a href="#get-vars" class="headerlink" title="get_vars()"></a>get_vars()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_vars</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_cached_vars;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取设置的变量。</p>
<hr>
<h4 id="helper"><a href="#helper" class="headerlink" title="helper()"></a>helper()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">helper</span><span class="params">($helpers = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    is_array($helpers) <span class="keyword">OR</span> $helpers = <span class="keyword">array</span>($helpers);<span class="comment">// 如果是单个传入这里就要构造成数组</span></span><br><span class="line">    <span class="keyword">foreach</span> ($helpers <span class="keyword">as</span> &amp;$helper)</span><br><span class="line">    &#123;</span><br><span class="line">        $filename = basename($helper);<span class="comment">// 获取文件名</span></span><br><span class="line">        $filepath = ($filename === $helper) ? <span class="string">''</span> : substr($helper, <span class="number">0</span>, strlen($helper) - strlen($filename));<span class="comment">// 文件名如果跟参数一致说明没有路径，不一致需要分割获取</span></span><br><span class="line">        $filename = strtolower(preg_replace(<span class="string">'#(_helper)?(\.php)?$#i'</span>, <span class="string">''</span>, $filename)).<span class="string">'_helper'</span>;<span class="comment">// 加后缀 _helper,比如 array_helper</span></span><br><span class="line">        $helper   = $filepath.$filename;<span class="comment">// 重组</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 已经加载过则判断下一个</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_helpers[$helper]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Is this a helper extension request?</span></span><br><span class="line">        $ext_helper = config_item(<span class="string">'subclass_prefix'</span>).$filename; <span class="comment">// $ext_helper = 'MY_array_helper'</span></span><br><span class="line">        $ext_loaded = <span class="keyword">FALSE</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_ci_helper_paths <span class="keyword">as</span> $path)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (file_exists($path.<span class="string">'helpers/'</span>.$ext_helper.<span class="string">'.php'</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">include_once</span>($path.<span class="string">'helpers/'</span>.$ext_helper.<span class="string">'.php'</span>);</span><br><span class="line">                $ext_loaded = <span class="keyword">TRUE</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If we have loaded extensions - check if the base one is here</span></span><br><span class="line">        <span class="comment">// 这里的意思是如果MY_array_helper.php存在但是array_helper.php不存在则报错</span></span><br><span class="line">        <span class="keyword">if</span> ($ext_loaded === <span class="keyword">TRUE</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $base_helper = BASEPATH.<span class="string">'helpers/'</span>.$helper.<span class="string">'.php'</span>;</span><br><span class="line">            <span class="keyword">if</span> ( ! file_exists($base_helper))</span><br><span class="line">            &#123;</span><br><span class="line">                show_error(<span class="string">'Unable to load the requested file: helpers/'</span>.$helper.<span class="string">'.php'</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">include_once</span>($base_helper);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_ci_helpers[$helper] = <span class="keyword">TRUE</span>;</span><br><span class="line">            log_message(<span class="string">'info'</span>, <span class="string">'Helper loaded: '</span>.$helper);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// No extensions found ... try loading regular helpers and/or overrides</span></span><br><span class="line">        <span class="comment">// 没找到MY_array_helper.php,则加载array_helper.php</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_ci_helper_paths <span class="keyword">as</span> $path)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (file_exists($path.<span class="string">'helpers/'</span>.$helper.<span class="string">'.php'</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">include_once</span>($path.<span class="string">'helpers/'</span>.$helper.<span class="string">'.php'</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">$this</span>-&gt;_ci_helpers[$helper] = <span class="keyword">TRUE</span>;</span><br><span class="line">                log_message(<span class="string">'info'</span>, <span class="string">'Helper loaded: '</span>.$helper);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// unable to load the helper</span></span><br><span class="line">        <span class="comment">// 没加载成功则报错</span></span><br><span class="line">        <span class="keyword">if</span> ( ! <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_helpers[$helper]))</span><br><span class="line">        &#123;</span><br><span class="line">            show_error(<span class="string">'Unable to load the requested file: helpers/'</span>.$helper.<span class="string">'.php'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面用到的php内置函数：</p>
<ol>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvemgvZnVuY3Rpb24uYmFzZW5hbWUucGhw" title="https://www.php.net/manual/zh/function.basename.php">basename: 返回路径中的文件名部分<i class="fa fa-external-link"></i></span></li>
</ol>
<hr>
<h4 id="helpers"><a href="#helpers" class="headerlink" title="helpers()"></a>helpers()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">helpers</span><span class="params">($helpers = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;helper($helpers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作用跟helper方法一致。</p>
<hr>
<h4 id="language"><a href="#language" class="headerlink" title="language()"></a>language()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载language文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">language</span><span class="params">($files, $lang = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    get_instance()-&gt;lang-&gt;load($files, $lang);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="config"><a href="#config" class="headerlink" title="config()"></a>config()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">config</span><span class="params">($file, $use_sections = FALSE, $fail_gracefully = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 调的是CI_Config类中的load()方法</span></span><br><span class="line">    <span class="keyword">return</span> get_instance()-&gt;config-&gt;load($file, $use_sections, $fail_gracefully);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="driver"><a href="#driver" class="headerlink" title="driver()"></a>driver()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">driver</span><span class="params">($library, $params = NULL, $object_name = NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_array($library))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> ($library <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_int($key))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;driver($value, $params);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;driver($key, $params, $value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (<span class="keyword">empty</span>($library))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! class_exists(<span class="string">'CI_Driver_Library'</span>, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// We aren't instantiating an object here, just making the base class available</span></span><br><span class="line">        <span class="comment">// 加载/system/libraries/Driver.php，该文件内有俩类: CI_Driver_Library作为缓存类的基类、 CI_Driver作为Nosql(redis、memcached)的基类.</span></span><br><span class="line">        <span class="comment">// 这里没有实例化对象，只是require文件</span></span><br><span class="line">        <span class="keyword">require</span> BASEPATH.<span class="string">'libraries/Driver.php'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We can save the loader some time since Drivers will *always* be in a subfolder,</span></span><br><span class="line">    <span class="comment">// and typically identically named to the library</span></span><br><span class="line">    <span class="keyword">if</span> ( ! strpos($library, <span class="string">'/'</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// /system/libraries/Cache/Cache.php</span></span><br><span class="line">        $library = ucfirst($library).<span class="string">'/'</span>.$library;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;library($library, $params, $object_name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="add-package-path"><a href="#add-package-path" class="headerlink" title="add_package_path()"></a>add_package_path()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_package_path</span><span class="params">($path, $view_cascade = TRUE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $path = rtrim($path, <span class="string">'/'</span>).<span class="string">'/'</span>;</span><br><span class="line">    <span class="comment">// $path = 'G:\wamp\www\CodeIgniter_hmvc\application\third_party/MX/'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将$path分别加入到_ci_library_paths/_ci_model_paths/_ci_helper_paths中</span></span><br><span class="line">    <span class="comment">// array_unshift()的作用是开头加入，后面foreach的时候也是先判断这个目录下有没有，因为自定义的文件通常继承core里的类</span></span><br><span class="line">    array_unshift(<span class="keyword">$this</span>-&gt;_ci_library_paths, $path);</span><br><span class="line">    array_unshift(<span class="keyword">$this</span>-&gt;_ci_model_paths, $path);</span><br><span class="line">    array_unshift(<span class="keyword">$this</span>-&gt;_ci_helper_paths, $path);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 两个数组相加：如果键名为字符，且键名相同，数组相加会将最先出现的值作为结果</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_view_paths = <span class="keyword">array</span>($path.<span class="string">'views/'</span> =&gt; $view_cascade) + <span class="keyword">$this</span>-&gt;_ci_view_paths;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add config file path 加载MX_Config, 即(&amp; get_instance())-&gt;config;</span></span><br><span class="line">    $config =&amp; <span class="keyword">$this</span>-&gt;_ci_get_component(<span class="string">'config'</span>);</span><br><span class="line">    $config-&gt;_config_paths[] = $path;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="get-package-paths"><a href="#get-package-paths" class="headerlink" title="get_package_paths()"></a>get_package_paths()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_package_paths</span><span class="params">($include_base = FALSE)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 返回已加载的package paths</span></span><br><span class="line">    <span class="keyword">return</span> ($include_base === <span class="keyword">TRUE</span>) ? <span class="keyword">$this</span>-&gt;_ci_library_paths : <span class="keyword">$this</span>-&gt;_ci_model_paths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="remove-package-path"><a href="#remove-package-path" class="headerlink" title="remove_package_path()"></a>remove_package_path()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove_package_path</span><span class="params">($path = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $config =&amp; <span class="keyword">$this</span>-&gt;_ci_get_component(<span class="string">'config'</span>);<span class="comment">// 配置类组件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($path === <span class="string">''</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// _ci_(library/model/helper/view)_paths在开头移除元素</span></span><br><span class="line">        <span class="comment">// $config-&gt;_config_paths在末尾移除元素</span></span><br><span class="line">        array_shift(<span class="keyword">$this</span>-&gt;_ci_library_paths);</span><br><span class="line">        array_shift(<span class="keyword">$this</span>-&gt;_ci_model_paths);</span><br><span class="line">        array_shift(<span class="keyword">$this</span>-&gt;_ci_helper_paths);</span><br><span class="line">        array_shift(<span class="keyword">$this</span>-&gt;_ci_view_paths);</span><br><span class="line">        array_pop($config-&gt;_config_paths);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $path = rtrim($path, <span class="string">'/'</span>).<span class="string">'/'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">'_ci_library_paths'</span>, <span class="string">'_ci_model_paths'</span>, <span class="string">'_ci_helper_paths'</span>) <span class="keyword">as</span> $var)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (($key = array_search($path, <span class="keyword">$this</span>-&gt;&#123;$var&#125;)) !== <span class="keyword">FALSE</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;&#123;$var&#125;[$key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_view_paths[$path.<span class="string">'views/'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;_ci_view_paths[$path.<span class="string">'views/'</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (($key = array_search($path, $config-&gt;_config_paths)) !== <span class="keyword">FALSE</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">unset</span>($config-&gt;_config_paths[$key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make sure the application default paths are still in the array</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_library_paths = array_unique(array_merge(<span class="keyword">$this</span>-&gt;_ci_library_paths, <span class="keyword">array</span>(APPPATH, BASEPATH)));</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_helper_paths = array_unique(array_merge(<span class="keyword">$this</span>-&gt;_ci_helper_paths, <span class="keyword">array</span>(APPPATH, BASEPATH)));</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_model_paths = array_unique(array_merge(<span class="keyword">$this</span>-&gt;_ci_model_paths, <span class="keyword">array</span>(APPPATH)));</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_view_paths = array_merge(<span class="keyword">$this</span>-&gt;_ci_view_paths, <span class="keyword">array</span>(APPPATH.<span class="string">'views/'</span> =&gt; <span class="keyword">TRUE</span>));</span><br><span class="line">    $config-&gt;_config_paths = array_unique(array_merge($config-&gt;_config_paths, <span class="keyword">array</span>(APPPATH)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ci-load"><a href="#ci-load" class="headerlink" title="_ci_load()"></a>_ci_load()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// view()、file()方法中调用</span></span><br><span class="line"><span class="comment">// view: array('_ci_view' =&gt; $view, '_ci_vars' =&gt; $this-&gt;_ci_prepare_view_vars($vars), '_ci_return' =&gt; $return)</span></span><br><span class="line"><span class="comment">// file: array('_ci_path' =&gt; $path, '_ci_return' =&gt; $return)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_ci_load</span><span class="params">($_ci_data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Set the default data variables</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">'_ci_view'</span>, <span class="string">'_ci_vars'</span>, <span class="string">'_ci_path'</span>, <span class="string">'_ci_return'</span>) <span class="keyword">as</span> $_ci_val)</span><br><span class="line">    &#123;</span><br><span class="line">        $$_ci_val = <span class="keyword">isset</span>($_ci_data[$_ci_val]) ? $_ci_data[$_ci_val] : <span class="keyword">FALSE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file_exists = <span class="keyword">FALSE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the path to the requested file</span></span><br><span class="line">    <span class="keyword">if</span> (is_string($_ci_path) &amp;&amp; $_ci_path !== <span class="string">''</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $_ci_x = explode(<span class="string">'/'</span>, $_ci_path);</span><br><span class="line">        $_ci_file = end($_ci_x);<span class="comment">// $_ci_x中最后一个元素是文件名</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $_ci_ext = pathinfo($_ci_view, PATHINFO_EXTENSION);<span class="comment">// 返回文件名，带有扩展名</span></span><br><span class="line">        $_ci_file = ($_ci_ext === <span class="string">''</span>) ? $_ci_view.<span class="string">'.php'</span> : $_ci_view;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_ci_view_paths <span class="keyword">as</span> $_ci_view_file =&gt; $cascade)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (file_exists($_ci_view_file.$_ci_file))</span><br><span class="line">            &#123;</span><br><span class="line">                $_ci_path = $_ci_view_file.$_ci_file;</span><br><span class="line">                $file_exists = <span class="keyword">TRUE</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( ! $cascade)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! $file_exists &amp;&amp; ! file_exists($_ci_path))</span><br><span class="line">    &#123;</span><br><span class="line">        show_error(<span class="string">'Unable to load the requested file: '</span>.$_ci_file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $_ci_CI =&amp; get_instance();</span><br><span class="line">    <span class="comment">// get_object_vars：返回由对象属性组成的关联数组</span></span><br><span class="line">    <span class="keyword">foreach</span> (get_object_vars($_ci_CI) <span class="keyword">as</span> $_ci_key =&gt; $_ci_var)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( ! <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;$_ci_key))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;$_ci_key =&amp; $_ci_CI-&gt;$_ci_key;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">empty</span>($_ci_vars) <span class="keyword">OR</span> <span class="keyword">$this</span>-&gt;_ci_cached_vars = array_merge(<span class="keyword">$this</span>-&gt;_ci_cached_vars, $_ci_vars);</span><br><span class="line">    extract(<span class="keyword">$this</span>-&gt;_ci_cached_vars);<span class="comment">// 从数组中将变量导入到当前的符号表</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//我们在控制器中调用$this-&gt;load-&gt;view()方法，</span></span><br><span class="line">    <span class="comment">//实质视图并没有马上输出来，而是先将它放到缓冲区。</span></span><br><span class="line">    ob_start();</span><br><span class="line">    <span class="comment">//就是这个地方，下面if中有一句eval(xxxx)以及else中有include;而里面的xxxx正是我们要加载的视图文件，</span></span><br><span class="line">    <span class="comment">//所以这就是为什么在视图文件里，var_dump($this)，会告诉你当前这个$this是Loader组件，因为视图的代码都是相当于嵌入这个地方。</span></span><br><span class="line">    <span class="comment">// 从 PHP 5.4.0 起， <span class="meta">&lt;?</span>= 总是可用的，但是小于php5.4需要替换</span></span><br><span class="line">    <span class="keyword">if</span> ( ! is_php(<span class="string">'5.4'</span>) &amp;&amp; ! ini_get(<span class="string">'short_open_tag'</span>) &amp;&amp; config_item(<span class="string">'rewrite_short_tags'</span>) === <span class="keyword">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// '<span class="meta">&lt;?</span>='替换为'<span class="meta">&lt;?</span> echo'， 去掉注释，将字符串作为php代码执行</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">eval</span>(<span class="string">'?&gt;'</span>.preg_replace(<span class="string">'/;*\s*\?&gt;/'</span>, <span class="string">'; ?&gt;'</span>, str_replace(<span class="string">'&lt;?='</span>, <span class="string">'&lt;?php echo '</span>, file_get_contents($_ci_path))));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">include</span>($_ci_path); <span class="comment">// include() vs include_once() allows for multiple views with the same name</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 经过上面的代码，我们的视图文件的内容已经放到了缓冲区了。</span></span><br><span class="line">    log_message(<span class="string">'info'</span>, <span class="string">'File loaded: '</span>.$_ci_path);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一般情况下，$_ci_return都为FLASE，即不要求通过$this-&gt;load-&gt;view()返回输出内容，而是直接放到缓冲区静候处理;</span></span><br><span class="line">    <span class="comment">//当然你也可以先拿出数据，在控制器里面处理一下，再输出，例如在控制器中$output=$this-&gt;load-&gt;view("x",$data,TRUE);，当为TRUE的时候，下面的代码就起作用了。</span></span><br><span class="line">    <span class="keyword">if</span> ($_ci_return === <span class="keyword">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $buffer = ob_get_contents();</span><br><span class="line">        @ob_end_clean();</span><br><span class="line">        <span class="keyword">return</span> $buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 下面这个很关键，因为有可能当前这个视图文件是被另一个视图文件通过$this-&gt;view()方法引入，</span></span><br><span class="line"><span class="comment">    * 即视图文件嵌入视图文件，从而导致多了一层缓冲。为了保证缓冲内容最后交给Output处理时，</span></span><br><span class="line"><span class="comment">    * 缓冲级别只比Loader组件加载时多1（这个1就是最父层的视图文件引起的）这里必须先flush掉当前层视图引起的这次缓冲，</span></span><br><span class="line"><span class="comment">    * 以保证Output正常工作。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (ob_get_level() &gt; <span class="keyword">$this</span>-&gt;_ci_ob_level + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ob_end_flush();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        * 如果不是多1，则说明当前引入的视图文件就是直接在控制器里面引入的那个，</span></span><br><span class="line"><span class="comment">        * 而不是由某个视图文件再引入的。把缓冲区的内容交给Output组件并清空关闭缓冲区。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        $_ci_CI-&gt;output-&gt;append_output(ob_get_contents());</span><br><span class="line">        @ob_end_clean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相关概念：</p>
<ol>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvemgvaW5pLmNvcmUucGhwI2luaS5zaG9ydC1vcGVuLXRhZw==" title="https://www.php.net/manual/zh/ini.core.php#ini.short-open-tag">short_open_tag<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvemgvZnVuY3Rpb24ub2Itc3RhcnQucGhw" title="https://www.php.net/manual/zh/function.ob-start.php">ob_start<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvemgvZnVuY3Rpb24uZXh0cmFjdC5waHA=" title="https://www.php.net/manual/zh/function.extract.php">extract<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvemgvZnVuY3Rpb24uZXZhbC5waHA=" title="https://www.php.net/manual/zh/function.eval.php">eval<i class="fa fa-external-link"></i></span></li>
</ol>
<hr>
<h4 id="ci-load-library"><a href="#ci-load-library" class="headerlink" title="_ci_load_library()"></a>_ci_load_library()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_ci_load_library</span><span class="params">($class, $params = NULL, $object_name = NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Get the class name, and while we're at it trim any slashes.</span></span><br><span class="line">    <span class="comment">// The directory path can be included as part of the class name,</span></span><br><span class="line">    <span class="comment">// but we don't want a leading slash</span></span><br><span class="line">    <span class="comment">// 若$class字符串中存在.php，去掉。。。</span></span><br><span class="line">    $class = str_replace(<span class="string">'.php'</span>, <span class="string">''</span>, trim($class, <span class="string">'/'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Was the path included with the class name?</span></span><br><span class="line">    <span class="comment">// We look for a slash to determine this</span></span><br><span class="line">    <span class="comment">// $class收尾去掉/后发现还有/就说明在子目录下了，这时要获取子目录</span></span><br><span class="line">    <span class="keyword">if</span> (($last_slash = strrpos($class, <span class="string">'/'</span>)) !== <span class="keyword">FALSE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Extract the path</span></span><br><span class="line">        $subdir = substr($class, <span class="number">0</span>, ++$last_slash);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the filename from the path</span></span><br><span class="line">        $class = substr($class, $last_slash);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $subdir = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类名首字符大写，这里再给格式化下</span></span><br><span class="line">    $class = ucfirst($class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is this a stock library? There are a few special conditions if so ...</span></span><br><span class="line">    <span class="comment">// BASEPATH.'libraries/'.$subdir.$class.'.php' = 'G:\wamp\www\CodeIgniter_hmvc\system\libraries/My_class.php'</span></span><br><span class="line">    <span class="keyword">if</span> (file_exists(BASEPATH.<span class="string">'libraries/'</span>.$subdir.$class.<span class="string">'.php'</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_load_stock_library($class, $subdir, $params, $object_name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Safety: Was the class already loaded by a previous call?</span></span><br><span class="line">    <span class="keyword">if</span> (class_exists($class, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 这里$property是类的别名，可能由于源类名太长另外指定一个名称来表示，如果没有单独指定则由源类名表示 $this-&gt;&#123;$property&#125;-&gt;...</span></span><br><span class="line">        $property = $object_name;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($property))</span><br><span class="line">        &#123;</span><br><span class="line">            $property = strtolower($class);</span><br><span class="line">            <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_varmap[$property]) &amp;&amp; $property = <span class="keyword">$this</span>-&gt;_ci_varmap[$property];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $CI =&amp; get_instance();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($CI-&gt;$property))</span><br><span class="line">        &#123;</span><br><span class="line">            log_message(<span class="string">'debug'</span>, $class.<span class="string">' class already loaded. Second attempt ignored.'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_init_library($class, <span class="string">''</span>, $params, $object_name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Let's search for the requested library file and load it.</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_ci_library_paths <span class="keyword">as</span> $path)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// BASEPATH has already been checked for // if (file_exists(BASEPATH.'libraries/'.$subdir.$class.'.php'))...</span></span><br><span class="line">        <span class="keyword">if</span> ($path === BASEPATH)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $filepath = $path.<span class="string">'libraries/'</span>.$subdir.$class.<span class="string">'.php'</span>;</span><br><span class="line">        <span class="comment">// Does the file exist? No? Bummer...</span></span><br><span class="line">        <span class="keyword">if</span> ( ! file_exists($filepath))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $filepath = 'G:\wamp\www\CodeIgniter_hmvc\application\libraries/My_class.php'</span></span><br><span class="line">        <span class="keyword">include_once</span>($filepath);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_init_library($class, <span class="string">''</span>, $params, $object_name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// One last attempt. Maybe the library is in a subdirectory, but it wasn't specified? 最后的努力，当成子目录来尝试加载</span></span><br><span class="line">    <span class="keyword">if</span> ($subdir === <span class="string">''</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// $this-&gt;_ci_load_library('My_class/My_class', null, null); 其实前面就已经返回了，这个值是前面打印出来的。。。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_load_library($class.<span class="string">'/'</span>.$class, $params, $object_name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we got this far we were unable to find the requested class.</span></span><br><span class="line">    log_message(<span class="string">'error'</span>, <span class="string">'Unable to load the requested class: '</span>.$class);</span><br><span class="line">    show_error(<span class="string">'Unable to load the requested class: '</span>.$class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ci-load-stock-library"><a href="#ci-load-stock-library" class="headerlink" title="_ci_load_stock_library()"></a>_ci_load_stock_library()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_ci_load_stock_library</span><span class="params">($library_name, $file_path, $params, $object_name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 比如参数可能是：</span></span><br><span class="line"><span class="comment">     * $library_name = "Xmlrpc"</span></span><br><span class="line"><span class="comment">     * $file_path = ''</span></span><br><span class="line"><span class="comment">     * $params = [ 'xss_clean' =&gt; false, 'debug' =&gt; false]</span></span><br><span class="line"><span class="comment">     * $object_name = NULL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    $prefix = <span class="string">'CI_'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (class_exists($prefix.$library_name, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 若一定义MY_Xmlrpc类, 则加载此类</span></span><br><span class="line">        <span class="keyword">if</span> (class_exists(config_item(<span class="string">'subclass_prefix'</span>).$library_name, <span class="keyword">FALSE</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            $prefix = config_item(<span class="string">'subclass_prefix'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $property = $object_name;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($property))</span><br><span class="line">        &#123;</span><br><span class="line">            $property = strtolower($library_name);</span><br><span class="line">            <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_varmap[$property]) &amp;&amp; $property = <span class="keyword">$this</span>-&gt;_ci_varmap[$property];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $CI =&amp; get_instance();</span><br><span class="line">        <span class="keyword">if</span> ( ! <span class="keyword">isset</span>($CI-&gt;$property))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_init_library($library_name, $prefix, $params, $object_name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log_message(<span class="string">'debug'</span>, $library_name.<span class="string">' class already loaded. Second attempt ignored.'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $paths = <span class="keyword">$this</span>-&gt;_ci_library_paths;</span><br><span class="line">    array_pop($paths); <span class="comment">// BASEPATH</span></span><br><span class="line">    array_pop($paths); <span class="comment">// APPPATH (needs to be the first path checked)</span></span><br><span class="line">    array_unshift($paths, APPPATH);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($paths <span class="keyword">as</span> $path)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($path = $path.<span class="string">'libraries/'</span>.$file_path.$library_name.<span class="string">'.php'</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Override</span></span><br><span class="line">            <span class="keyword">include_once</span>($path);</span><br><span class="line">            <span class="keyword">if</span> (class_exists($prefix.$library_name, <span class="keyword">FALSE</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_init_library($library_name, $prefix, $params, $object_name);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log_message(<span class="string">'debug'</span>, $path.<span class="string">' exists, but does not declare '</span>.$prefix.$library_name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include_once</span>(BASEPATH.<span class="string">'libraries/'</span>.$file_path.$library_name.<span class="string">'.php'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check for extensions</span></span><br><span class="line">    $subclass = config_item(<span class="string">'subclass_prefix'</span>).$library_name;</span><br><span class="line">    <span class="keyword">foreach</span> ($paths <span class="keyword">as</span> $path)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($path = $path.<span class="string">'libraries/'</span>.$file_path.$subclass.<span class="string">'.php'</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">include_once</span>($path);</span><br><span class="line">            <span class="keyword">if</span> (class_exists($subclass, <span class="keyword">FALSE</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                $prefix = config_item(<span class="string">'subclass_prefix'</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log_message(<span class="string">'debug'</span>, $path.<span class="string">' exists, but does not declare '</span>.$subclass);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_ci_init_library($library_name, $prefix, $params, $object_name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ci-init-library"><a href="#ci-init-library" class="headerlink" title="_ci_init_library()"></a>_ci_init_library()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_ci_init_library</span><span class="params">($class, $prefix, $config = FALSE, $object_name = NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Is there an associated config file for this class? <span class="doctag">Note:</span> these should always be lowercase</span></span><br><span class="line">    <span class="keyword">if</span> ($config === <span class="keyword">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Fetch the config paths containing any package paths</span></span><br><span class="line">        $config_component = <span class="keyword">$this</span>-&gt;_ci_get_component(<span class="string">'config'</span>);<span class="comment">// 返回的是MX_Config</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_array($config_component-&gt;_config_paths))</span><br><span class="line">        &#123;</span><br><span class="line">            $found = <span class="keyword">FALSE</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($config_component-&gt;_config_paths <span class="keyword">as</span> $path)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// We test for both uppercase and lowercase, for servers that</span></span><br><span class="line">                <span class="comment">// are case-sensitive with regard to file names. Load global first,</span></span><br><span class="line">                <span class="comment">// override with environment next</span></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * 在config目录下寻找library...</span></span><br><span class="line"><span class="comment">                 * $path.'config/'.strtolower($class).'.php' = 'G:\wamp\www\CodeIgniter_hmvc\application\config/my_class.php';</span></span><br><span class="line"><span class="comment">                 * $path.'config/'.ucfirst(strtolower($class)).'.php' = 'G:\wamp\www\CodeIgniter_hmvc\application\config/My_class.php'</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (file_exists($path.<span class="string">'config/'</span>.strtolower($class).<span class="string">'.php'</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">include</span>($path.<span class="string">'config/'</span>.strtolower($class).<span class="string">'.php'</span>);</span><br><span class="line">                    $found = <span class="keyword">TRUE</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">elseif</span> (file_exists($path.<span class="string">'config/'</span>.ucfirst(strtolower($class)).<span class="string">'.php'</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">include</span>($path.<span class="string">'config/'</span>.ucfirst(strtolower($class)).<span class="string">'.php'</span>);</span><br><span class="line">                    $found = <span class="keyword">TRUE</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (file_exists($path.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/'</span>.strtolower($class).<span class="string">'.php'</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">include</span>($path.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/'</span>.strtolower($class).<span class="string">'.php'</span>);</span><br><span class="line">                    $found = <span class="keyword">TRUE</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">elseif</span> (file_exists($path.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/'</span>.ucfirst(strtolower($class)).<span class="string">'.php'</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">include</span>($path.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/'</span>.ucfirst(strtolower($class)).<span class="string">'.php'</span>);</span><br><span class="line">                    $found = <span class="keyword">TRUE</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Break on the first found configuration, thus package</span></span><br><span class="line">                <span class="comment">// files are not overridden by default paths</span></span><br><span class="line">                <span class="keyword">if</span> ($found === <span class="keyword">TRUE</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $class_name = $prefix.$class;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is the class name valid?</span></span><br><span class="line">    <span class="keyword">if</span> ( ! class_exists($class_name, <span class="keyword">FALSE</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        log_message(<span class="string">'error'</span>, <span class="string">'Non-existent class: '</span>.$class_name);</span><br><span class="line">        show_error(<span class="string">'Non-existent class: '</span>.$class_name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the variable name we will assign the class to</span></span><br><span class="line">    <span class="comment">// Was a custom class name supplied? If so we'll use it</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($object_name))</span><br><span class="line">    &#123;</span><br><span class="line">        $object_name = strtolower($class);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_ci_varmap[$object_name]))</span><br><span class="line">        &#123;</span><br><span class="line">            $object_name = <span class="keyword">$this</span>-&gt;_ci_varmap[$object_name];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Don't overwrite existing properties</span></span><br><span class="line">    $CI =&amp; get_instance();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($CI-&gt;$object_name))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($CI-&gt;$object_name <span class="keyword">instanceof</span> $class_name)</span><br><span class="line">        &#123;</span><br><span class="line">            log_message(<span class="string">'debug'</span>, $class_name.<span class="string">" has already been instantiated as '"</span>.$object_name.<span class="string">"'. Second attempt aborted."</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        show_error(<span class="string">"Resource '"</span>.$object_name.<span class="string">"' already exists and is not a "</span>.$class_name.<span class="string">" instance."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save the class name and object name</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;_ci_classes[$object_name] = $class;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Instantiate the class 实例化类，这一步很关键，完成最后的加载， $CI-&gt;my_class = new My_class();</span></span><br><span class="line">    $CI-&gt;$object_name = <span class="keyword">isset</span>($config)</span><br><span class="line">        ? <span class="keyword">new</span> $class_name($config)</span><br><span class="line">        : <span class="keyword">new</span> $class_name();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ci-autoloader"><a href="#ci-autoloader" class="headerlink" title="_ci_autoloader()"></a>_ci_autoloader()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_ci_autoloader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// include G:\wamp\www\CodeIgniter_hmvc\application\config/autoload.php</span></span><br><span class="line">    <span class="keyword">if</span> (file_exists(APPPATH.<span class="string">'config/autoload.php'</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">include</span>(APPPATH.<span class="string">'config/autoload.php'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// include G:\wamp\www\CodeIgniter_hmvc\application\config/development/autoload.php</span></span><br><span class="line">    <span class="keyword">if</span> (file_exists(APPPATH.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/autoload.php'</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">include</span>(APPPATH.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/autoload.php'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果需要自动加载的文件，提前写入autoload.php,比如My_class.php</span></span><br><span class="line"><span class="comment">     * $autoload = [</span></span><br><span class="line"><span class="comment">     *      'packages' =&gt; [],</span></span><br><span class="line"><span class="comment">     *      'libraries' =&gt; [</span></span><br><span class="line"><span class="comment">     *          0 =&gt; string 'my_class' (length=8)</span></span><br><span class="line"><span class="comment">     *      ],</span></span><br><span class="line"><span class="comment">     *      'drivers' =&gt; [],</span></span><br><span class="line"><span class="comment">     *      'helper' =&gt; [],</span></span><br><span class="line"><span class="comment">     *      'config' =&gt; [],</span></span><br><span class="line"><span class="comment">     *      'language' =&gt; [],</span></span><br><span class="line"><span class="comment">     *      'model' =&gt; [],</span></span><br><span class="line"><span class="comment">     * ]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> ( ! <span class="keyword">isset</span>($autoload))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Autoload packages</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * $autoload['packages'] = [</span></span><br><span class="line"><span class="comment">     *      0 =&gt; string 'G:\wamp\www\CodeIgniter_hmvc\application\third_party/MX' (length=55)</span></span><br><span class="line"><span class="comment">     * ]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($autoload[<span class="string">'packages'</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> ($autoload[<span class="string">'packages'</span>] <span class="keyword">as</span> $package_path)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;add_package_path($package_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load any custom config file 加载autoload.php中配置的config文件，即$autoload['config'] = array('codeigniter');</span></span><br><span class="line">    <span class="keyword">if</span> (count($autoload[<span class="string">'config'</span>]) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * $autoload['config'] = [</span></span><br><span class="line"><span class="comment">         *      0 =&gt; string 'codeigniter'</span></span><br><span class="line"><span class="comment">         * ]</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">foreach</span> ($autoload[<span class="string">'config'</span>] <span class="keyword">as</span> $val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// $this-&gt;config('codeigniter');</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;config($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Autoload helpers and languages</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">'helper'</span>, <span class="string">'language'</span>) <span class="keyword">as</span> $type)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($autoload[$type]) &amp;&amp; count($autoload[$type]) &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * $autoload['helper'] = [</span></span><br><span class="line"><span class="comment">             *      0 =&gt; string 'array' (length=5)</span></span><br><span class="line"><span class="comment">             *      1 =&gt; string 'language' (length=8)</span></span><br><span class="line"><span class="comment">             * ]</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;$type($autoload[$type]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Autoload drivers</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($autoload[<span class="string">'drivers'</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;driver($autoload[<span class="string">'drivers'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load libraries</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($autoload[<span class="string">'libraries'</span>]) &amp;&amp; count($autoload[<span class="string">'libraries'</span>]) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Load the database driver. 此处是指初始化时就加载数据库</span></span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="string">'database'</span>, $autoload[<span class="string">'libraries'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 加载DB类，只有加载了才能使用$this-&gt;db-&gt;...</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;database();</span><br><span class="line">            <span class="comment">// 返回不包含'database'的数组</span></span><br><span class="line">            $autoload[<span class="string">'libraries'</span>] = array_diff($autoload[<span class="string">'libraries'</span>], <span class="keyword">array</span>(<span class="string">'database'</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Load all other libraries</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;library($autoload[<span class="string">'libraries'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Autoload models</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($autoload[<span class="string">'model'</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;model($autoload[<span class="string">'model'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ci-prepare-view-vars"><a href="#ci-prepare-view-vars" class="headerlink" title="_ci_prepare_view_vars()"></a>_ci_prepare_view_vars()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_ci_prepare_view_vars</span><span class="params">($vars)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( ! is_array($vars))</span><br><span class="line">    &#123;</span><br><span class="line">        $vars = is_object($vars)</span><br><span class="line">            ? get_object_vars($vars)</span><br><span class="line">            : <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (array_keys($vars) <span class="keyword">as</span> $key)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (strncmp($key, <span class="string">'_ci_'</span>, <span class="number">4</span>) === <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">unset</span>($vars[$key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $vars;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ci-get-component"><a href="#ci-get-component" class="headerlink" title="_ci_get_component()"></a>_ci_get_component()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> &amp;<span class="title">_ci_get_component</span><span class="params">($component)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $CI =&amp; get_instance();</span><br><span class="line">    <span class="keyword">return</span> $CI-&gt;$component;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1poaWh1YV9XL2FydGljbGUvZGV0YWlscy81Mjk1NjY5Mg==" title="https://blog.csdn.net/Zhihua_W/article/details/52956692">CI框架源码解析十六之加载器类文件Loader.php<i class="fa fa-external-link"></i></span></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>W E N C H A O
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://pureven.cc/2020/02/17/codeigniter-loader/" title="CodeIgniter加载类文件Loader.php">https://pureven.cc/2020/02/17/codeigniter-loader/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9udWxs"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/PHP/" rel="tag"><i class="fa fa-tag"></i> PHP</a>
              <a href="/tags/Codeigniter/" rel="tag"><i class="fa fa-tag"></i> Codeigniter</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/02/16/codeigniter-m/" rel="next" title="CodeIgniter模型类文件Model.php">
                  <i class="fa fa-chevron-left"></i> CodeIgniter模型类文件Model.php
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2020/02/22/codeigniter-exceptions/" rel="prev" title="CodeIgniter异常类文件Exceptions.php">
                  CodeIgniter异常类文件Exceptions.php <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#成员变量"><span class="nav-number">2.</span> <span class="nav-text">成员变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#construct"><span class="nav-number">3.</span> <span class="nav-text">__construct()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#initialize"><span class="nav-number">4.</span> <span class="nav-text">initialize()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#is-loaded"><span class="nav-number">5.</span> <span class="nav-text">is_loaded()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#library"><span class="nav-number">6.</span> <span class="nav-text">library()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#model"><span class="nav-number">7.</span> <span class="nav-text">model()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#database"><span class="nav-number">8.</span> <span class="nav-text">database()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dbutil"><span class="nav-number">9.</span> <span class="nav-text">dbutil()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dbforge"><span class="nav-number">10.</span> <span class="nav-text">dbforge()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#view"><span class="nav-number">11.</span> <span class="nav-text">view()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#file"><span class="nav-number">12.</span> <span class="nav-text">file()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vars"><span class="nav-number">13.</span> <span class="nav-text">vars()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clear-vars"><span class="nav-number">14.</span> <span class="nav-text">clear_vars()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-var"><span class="nav-number">15.</span> <span class="nav-text">get_var()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-vars"><span class="nav-number">16.</span> <span class="nav-text">get_vars()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#helper"><span class="nav-number">17.</span> <span class="nav-text">helper()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#helpers"><span class="nav-number">18.</span> <span class="nav-text">helpers()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#language"><span class="nav-number">19.</span> <span class="nav-text">language()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#config"><span class="nav-number">20.</span> <span class="nav-text">config()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#driver"><span class="nav-number">21.</span> <span class="nav-text">driver()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#add-package-path"><span class="nav-number">22.</span> <span class="nav-text">add_package_path()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-package-paths"><span class="nav-number">23.</span> <span class="nav-text">get_package_paths()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#remove-package-path"><span class="nav-number">24.</span> <span class="nav-text">remove_package_path()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-load"><span class="nav-number">25.</span> <span class="nav-text">_ci_load()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-load-library"><span class="nav-number">26.</span> <span class="nav-text">_ci_load_library()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-load-stock-library"><span class="nav-number">27.</span> <span class="nav-text">_ci_load_stock_library()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-init-library"><span class="nav-number">28.</span> <span class="nav-text">_ci_init_library()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-autoloader"><span class="nav-number">29.</span> <span class="nav-text">_ci_autoloader()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-prepare-view-vars"><span class="nav-number">30.</span> <span class="nav-text">_ci_prepare_view_vars()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ci-get-component"><span class="nav-number">31.</span> <span class="nav-text">_ci_get_component()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考链接"><span class="nav-number">32.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a href="/">
  <img class="site-author-image" itemprop="image" alt="W E N C H A O"
    src="/images/Snowflake_Snow.png">
</a>
  <p class="site-author-name" itemprop="name">W E N C H A O</p>
  <div class="site-description" itemprop="description">不积跬步•无以至千里</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B1cmV2ZW4=" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;pureven"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjE5Nzg4OTA4NThAcXEuY29t" title="E-Mail &amp;rarr; mailto:1978890858@qq.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWI=" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;docs&#x2F;Web">Web 开发技术 | MDN</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvZGV2ZG9jcw==" title="https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;devdocs">开发者手册 - 云+社区 - 腾讯云</span>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">W E N C H A O</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">335k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:05</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'oHc91UAhBsCsHsozJKCtNWgs-gzGzoHsz',
    appKey: '2voBHHj0cAqUynyNLoG4JoQf',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/click.js"></script>
